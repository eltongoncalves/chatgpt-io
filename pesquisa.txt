package com.example.integration.adapter.feign.dto;

import lombok.Data;
import java.util.List;

@Data
public class RequestDTO {
    private String nomeTitular;
    private String cpfCnpj;
    private String dataEmissao;
    private double limiteTotal;
    private double limiteDisponivel;
    private double limiteUtilizado;
    private CaracteristicaCreditoDTO caracteristicaCredito;
    private List<ParcelamentoDTO> parcelamentoFatura;
    private List<ParcelamentoDTO> parcelamentoAutomatico;
}




package com.example.integration.adapter.feign.dto;

import lombok.Data;

@Data
public class CaracteristicaCreditoDTO {
    private String modalidade;
    private String sistemaAmortizacao;
    private String idContratoPortabilidade;
    private double jurosCobrados;
    private double jurosPendenteCobranca;
    private double taxaJurosMensal;
    private double taxaJurosAnualNominal;
    private double taxaJurosAnualEfetiva;
    private int parcelasContrato;
    private int parcelasAbertas;
    private String dataUltimoVencimento;
    private double valorOriginalDivida;
    private double saldoDevedor;
    private String dataAtualizacao;
}


package com.example.integration.adapter.feign.dto;

import lombok.Data;

@Data
public class ParcelamentoDTO {
    private int numeroParcela;
    private String dataVencimento;
    private double principalIOF;
    private double encargos;
    private double valorParcela;
    private String status;
}

package com.example.integration.adapter.feign.dto;

import lombok.Data;

@Data
public class ResponseDTO {
    private String status;
    private String message;
}

package com.example.integration.domain;

public interface GeradorPdfPort {
    PdfResponse gerarPdf(PdfRequest request);
}


package com.example.integration.adapter.feign;

import com.example.integration.adapter.feign.dto.RequestDTO;
import com.example.integration.domain.GeradorPdfPort;
import com.example.integration.domain.PdfRequest;
import com.example.integration.domain.PdfResponse;
import org.springframework.stereotype.Component;

@Component
public class GeradorPdfAdapter implements GeradorPdfPort {

    private final GeradorPdfFeignClient feignClient;

    public GeradorPdfAdapter(GeradorPdfFeignClient feignClient) {
        this.feignClient = feignClient;
    }

    @Override
    public PdfResponse gerarPdf(PdfRequest request) {
        RequestDTO dto = mapToRequestDTO(request);
        return mapToPdfResponse(feignClient.gerarPdf(dto));
    }

    private RequestDTO mapToRequestDTO(PdfRequest request) {
        // Mapeamento do domínio para o DTO (pode ser automatizado com MapStruct)
        return new RequestDTO();
    }

    private PdfResponse mapToPdfResponse(ResponseDTO response) {
        // Mapeamento do ResponseDTO para o domínio
        return new PdfResponse(response.getStatus(), response.getMessage());
    }
}


package com.example.integration.application;

import com.example.integration.domain.GeradorPdfPort;
import com.example.integration.domain.PdfRequest;
import com.example.integration.domain.PdfResponse;
import org.springframework.stereotype.Service;

@Service
public class GeradorPdfService {

    private final GeradorPdfPort port;

    public GeradorPdfService(GeradorPdfPort port) {
        this.port = port;
    }

    public PdfResponse gerarPdf(PdfRequest request) {
        return port.gerarPdf(request);
    }
}


package com.example.integration.configuration;

import org.springframework.context.annotation.Bean;
import feign.Logger;

public class FeignConfig {

    @Bean
    Logger.Level feignLoggerLevel() {
        return Logger.Level.FULL;
    }
}


package com.example.integration.application;

import com.example.integration.domain.PdfRequest;
import com.example.integration.domain.PdfResponse;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class GeradorPdfController {

    private final GeradorPdfService service;

    public GeradorPdfController(GeradorPdfService service) {
        this.service = service;
    }

    @PostMapping("/gerar-pdf")
    public PdfResponse gerarPdf(@RequestBody PdfRequest request) {
        return service.gerarPdf(request);
    }
}
